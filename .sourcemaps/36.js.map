{"version":3,"sources":["../../src/pages/security/login/login.module.ts","../../src/pages/security/login/login.ts"],"names":[],"mappings":"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","file":"36.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { LoginPage } from './login';\r\n//import { TranslationModule } from '../../../translation/translate.module'\r\nimport { TranslateModule, TranslateLoader } from '@ngx-translate/core';\r\n\r\n@NgModule({\r\n  declarations: [LoginPage],\r\n  imports: [TranslateModule, IonicPageModule.forChild(LoginPage)],\r\n  exports: [LoginPage]\r\n})\r\nexport class LoginPageModule { }\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/security/login/login.module.ts","import { Component } from '@angular/core';\nimport { NavController, NavParams, LoadingController, IonicPage, MenuController, ToastController, AlertController, Events, ViewController } from 'ionic-angular';\nimport { PouchdbProvider } from '../../../providers/pouchdb-provider';\n//import { TabsPage } from '../tabs/tabs';\n//import { RegisterPage } from '../register/register';\nimport { Validators, FormBuilder } from '@angular/forms';\n//import { MyApp } from '../../app/app.component';\nimport { Storage } from '@ionic/storage';\nimport { TranslateService } from '@ngx-translate/core';\nimport { global } from '../../../global-variables/variable';\n//import { ConfigBoutiquePage } from '../accueil/config-boutique/config-boutique';\n/*\n  Generated class for the Login page.\n\n  See http://ionicframework.com/docs/v2/components/#navigation for more info on\n  Ionic pages and navigation.\n*/\n@IonicPage()\n@Component({\n  selector: 'page-login',\n  templateUrl: 'login.html'\n})\nexport class LoginPage {\n\n  //username: string;\n  //mdpass: string;\n  //adminOK: any = -1;\n  loginForm: any;\n  //tache: any = '';\n  user: any = {\n    'email': '',\n    'mdpass': ''\n  };\n  //configOK: any = global.configOK;\n\n  constructor(public alertCtl: AlertController, public events: Events, public translate: TranslateService, public viewCtl: ViewController, public toastCtl: ToastController, public servicePouchdb: PouchdbProvider, public navCtrl: NavController, public storage: Storage, public menuCtrl: MenuController, public formBuilder: FormBuilder, public navParams: NavParams, public loadinCtl: LoadingController) {\n    /*this.storage.get('info_connexion').then((user) => {\n      if(user){\n        this.user = user;\n      }\n      \n    }, err => console.log(err));*/\n\n  \n      if(global.info_connexion !== null){\n        this.user = global.info_connexion;\n      }\n\n    this.translate.setDefaultLang(global.langue);\n    //this.tache = this.navParams.data.tache;\n    this.loginForm = this.formBuilder.group({\n      email: ['', Validators.required],\n      mdpass: ['', Validators.required]\n    });\n  } \n\n     dismiss(){\n    this.viewCtl.dismiss();\n  }\n\n  ionViewWillEnter() {\n    this.translate.use(global.langue);\n    //console.log('ionViewDidLoad LoginPage');\n  }\n\n  afficheMsg(msg: string){\n    let toast = this.toastCtl.create({\n      message: msg,\n      position: 'top',\n      duration: 3000\n    });\n\n    toast.present();\n  }\n\n  login(){\n    \n    let loading = this.loadinCtl.create({\n      content: 'Connexion en cours...'\n    });\n    loading.present();\n    let user = this.loginForm.value\n    let ajaxOpts = {\n      ajax: {\n        headers: {\n          Authorization: 'Basic ' + window.btoa(user.email + ':' + user.mdpass)\n        }\n      }\n    };\n    //this.remote.login(username, mdpass, ajaxOpts).then((err, response) =\n    this.servicePouchdb.remoteSaved.login(user.email, user.mdpass, ajaxOpts, (err, response) => {\n      if (err) {\n        loading.dismissAll();\n        if (err.name === 'unauthorized') {\n          alert('Nom ou mot de passe incorrecte');\n          \n        } else {\n          alert('Une erreur s\\'est produite. Veuillez réessayer plus tard '+err);\n          \n        }\n      }else if(response){\n        //alert('success');\n        //this.MyApp.setPage();\n        //let m = MyApp.g\n        //m.setPage();\n        //this.menuCtrl.enable(true, 'menu2');\n        //this.menuCtrl.enable(false, 'menu1');\n        this.storage.set('info_connexion', user);\n        global.info_connexion = user;\n        global.estConnecte = true;\n        this.events.publish('user:login', response);\n        //this.events.publish('user:login_com', response);\n        this.servicePouchdb.remoteSaved.getUser(user.email, (err, us) => {\n          if (err) {\n            //this.viewCtl.dismiss();\n             loading.dismissAll();\n            if (err.name === 'not_found') {\n              // typo, or you don't have the privileges to see this user\n              //alert('Privilèges insuffiasants');\n              this.servicePouchdb.remoteSaved.getSession((err, response) =>{\n                if (err) {\n                  // network error\n                  alert('Erreur du réseau');\n                } else if (!response.userCtx.name) {\n                  // nobody's logged in\n                  alert('Non connecté ou privilèges insuffiasants');\n                } else {\n                  // response.userCtx.name is the current user\n                  loading.dismissAll();\n                  //this.user = us;\n                  this.storage.set('info_user', response.userCtx);\n                  global.info_user = response.userCtx;\n                  this.servicePouchdb.sync();\n                  this.afficheMsg('Connexion terminée avec succèes. \\nVous êtes connectés!')\n                  this.viewCtl.dismiss();\n                }\n              });\n            } else {\n              // some other error\n              alert('Erreur');\n            }\n          } else {\n            loading.dismissAll();\n           //this.user = us;\n           this.storage.set('info_user', us);\n           global.info_user = us;\n           this.servicePouchdb.sync();\n           this.afficheMsg('Connexion terminée avec succèes. \\nVous êtes connectés!')\n           this.viewCtl.dismiss();\n          }\n        });        \n  \n      }else{ \n        loading.dismissAll();\n        alert('echec');\n      }\n    });\n  }\n\n  /*enableAuthenticatedMenu() {\n    this.menuCtrl.enable(true, 'authenticated');\n    this.menuCtrl.enable(false, 'unauthenticated');\n  }*/\n\n  register(){\n    this.navCtrl.push('RegisterPage');\n  }\n\n  connexionUlterieur(){\n    let avr: any = '';\n    let att: any = '';\n\n    let alert = this.alertCtl.create({\n      title: avr,\n      message: att, \n      buttons: [\n        {\n          text: 'Annuler',\n          handler: () => console.log('annuler')\n        },\n        {\n          text: 'OK',\n          role: 'Cancel',\n          handler: () => {\n            this.viewCtl.dismiss();\n            //this.navCtrl.push(ConfigBoutiquePage);\n          }\n        }\n      ]\n    });\n\n    alert.present();\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/security/login/login.ts"],"sourceRoot":""}